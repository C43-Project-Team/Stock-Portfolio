<p-toast></p-toast>
<div class="container mx-auto p-4 pt-12">
  <div class="flex items-center mb-4">
    <div>
      <h1 class="text-2xl font-bold">{{ portfolioName }}</h1>
      <h2 class="text-xl">By {{ username }}</h2>
    </div>
    <div class="ml-auto">
      <p-button label="Deposit Money" icon="pi pi-dollar" class="p-button-success mr-2" (click)="showDepositDialog()"></p-button>
      <p-button label="Buy New Stock" icon="pi pi-plus" class="p-button-success" (click)="showBuyNewStockDialog()"></p-button>
    </div>
  </div>

  <div class="mb-4">
    <h3 class="text-lg font-semibold">Current Cash: {{ portfolioCash | currency }}</h3>
  </div>

  <p-table [value]="investments" class="p-datatable-sm">
    <ng-template pTemplate="header">
      <tr>
        <th>Stock Symbol</th>
        <th>Number of Shares</th>
        <th>Actions</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-investment>
      <tr>
        <td>{{ investment.stock_symbol }}</td>
        <td>{{ investment.num_shares }}</td>
        <td>
          <div class="flex gap-x-2">
              <button pButton type="button" icon="pi pi-minus" class="p-button-danger p-button-rounded" (click)="showSellSharesDialog(investment.stock_symbol)"></button>
            <button pButton type="button" icon="pi pi-plus" class="p-button-success p-button-rounded" (click)="showBuySharesDialog(investment.stock_symbol)"></button>
            <button pButton type="button" icon="pi pi-arrow-right" class="p-button-rounded" (click)="goToStock(investment.stock_symbol)"></button>
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>

  <p-dialog header="Deposit Money" [(visible)]="displayDepositDialog" [modal]="true" [closable]="true" [dismissableMask]="true" [responsive]="true" [style]="{ width: '20rem' }" [baseZIndex]="10000">
    <div class="p-fluid">
      <div class="p-field mb-4">
        <label for="depositAmount" class="block text-sm font-medium text-gray-700">Amount</label>
        <input id="depositAmount" type="number" pInputText [(ngModel)]="depositAmount" class="mt-1 block w-full" />
      </div>
      <div class="text-right">
        <p-button label="Deposit" class="p-button-success" (click)="depositMoney()" [disabled]="!depositAmount"></p-button>
      </div>
    </div>
  </p-dialog>

  <p-dialog header="Buy Shares" [(visible)]="displayBuySharesDialog" [modal]="true" [closable]="true" [dismissableMask]="true" [responsive]="true" [style]="{ width: '20rem' }" [baseZIndex]="10000">
    <div class="p-fluid">
      <div class="p-field mb-4">
        <label for="buyStockSymbol" class="block text-sm font-medium text-gray-700">Stock Symbol</label>
        <input id="buyStockSymbol" type="text" pInputText [(ngModel)]="buyStockSymbol" (ngModelChange)="calculateTotalCost()" class="mt-1 block w-full" />
      </div>
      <div class="p-field mb-4">
        <label for="buyNumShares" class="block text-sm font-medium text-gray-700">Number of Shares</label>
        <input id="buyNumShares" type="number" pInputText [(ngModel)]="buyNumShares" (ngModelChange)="calculateTotalCost()" class="mt-1 block w-full" />
      </div>
      <div class="mb-4">
        <h3 class="text-lg font-semibold">Current Cash: {{ portfolioCash | currency }}</h3>
        <h3 class="text-lg">
          Total Cost: 
          <span [ngClass]="{ 'text-green-600': hasEnoughFunds, 'text-red-600': !hasEnoughFunds }">
            {{ totalCost | currency }}
          </span>
        </h3>
      </div>
      <div class="text-right">
        <p-button label="Buy" class="p-button-success" (click)="buyShares()" [disabled]="!buyStockSymbol || !buyNumShares || !hasEnoughFunds"></p-button>
      </div>
    </div>
  </p-dialog>

  <p-dialog header="Sell Shares" [(visible)]="displaySellSharesDialog" [modal]="true" [closable]="true" [dismissableMask]="true" [responsive]="true" [style]="{ width: '20rem' }" [baseZIndex]="10000">
    <div class="p-fluid">
      <div class="p-field mb-4">
        <label for="sellStockSymbol" class="block text-sm font-medium text-gray-700">Stock Symbol</label>
        <input id="sellStockSymbol" type="text" pInputText [(ngModel)]="sellStockSymbol" class="mt-1 block w-full" />
      </div>
      <div class="p-field mb-4">
        <label for="sellNumShares" class="block text-sm font-medium text-gray-700">Number of Shares</label>
        <input id="sellNumShares" type="number" pInputText [(ngModel)]="sellNumShares" class="mt-1 block w-full" />
      </div>
      <div class="text-right">
        <p-button label="Sell" class="p-button-danger" (click)="sellShares()" [disabled]="!sellStockSymbol || !sellNumShares"></p-button>
      </div>
    </div>
  </p-dialog>
</div>
