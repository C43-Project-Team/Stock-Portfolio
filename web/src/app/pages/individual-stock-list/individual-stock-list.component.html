<p-toast></p-toast>
<p-progressSpinner *ngIf="loading" styleClass="absolute left-[50%] top-[50%] -translate-x-[50%] -translate-y-[50%]"></p-progressSpinner>
<div class="container mx-auto p-4 pt-12" *ngIf="hasAccess && !loading">
  <!-- Add Date Filter Button -->
  <div class="flex items-center mb-4">
    <div>
      <h1 class="text-2xl font-bold">{{ stockListName }}</h1>
      <h2 class="text-xl">By {{ username }}</h2>
    </div>
    <div class="ml-auto flex gap-2">
      <p-button
        label="Add Stock"
        icon="pi pi-plus"
        class="p-button-success"
        (click)="showAddStockDialog()"
        *ngIf="isOwner"
      ></p-button>
      <p-toggleButton
        onLabel="Private"
        offLabel="Public"
        onIcon="pi pi-lock"
        offIcon="pi pi-unlock"
        [(ngModel)]="isPrivate"
        (onChange)="toggleVisibility()"
        *ngIf="isOwner"
      ></p-toggleButton>
      <p-button
        label="Share Stock List"
        icon="pi pi-share-alt"
        class="p-button-info"
        (click)="showShareStockListDialog()"
        *ngIf="isOwner && isPrivate"
      ></p-button>
      <p-button
        label="Add Date Filter"
        icon="pi pi-calendar"
        class="p-button-info ml-2"
        (click)="showDateFilterDialog()"
      ></p-button>
    </div>
  </div>

  <!-- Add Stock List Beta -->
  <div class="mb-4 flex flex-row">
    <h3 class="text-lg font-semibold">Stock List Beta: {{ stockListBeta }}</h3>
  </div>

  <p-table [value]="stocks" class="p-datatable-sm">
    <ng-template pTemplate="header">
      <tr>
        <th>Stock Symbol</th>
        <th>Number of Shares</th>
        <th>Coefficient of Variation</th>
        <th>Stock Beta</th>
        <th>Actions</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-stock>
      <tr>
        <td>{{ stock.stock_symbol }}</td>
        <td>{{ stock.num_shares }}</td>
        <td>{{ stock.stock_cov + ' %' }}</td>
        <td>{{ stock.stock_beta }}</td>
        <td>
          <div class="flex gap-x-2">
            <button
              pButton
              type="button"
              icon="pi pi-minus"
              class="p-button-danger p-button-rounded"
              (click)="removeShares(stock.stock_symbol, 1)"
              *ngIf="isOwner"
            ></button>
            <button
              pButton
              type="button"
              icon="pi pi-plus"
              class="p-button-success p-button-rounded"
              (click)="addStock(stock.stock_symbol, 1)"
              *ngIf="isOwner"
            ></button>
            <button
              pButton
              type="button"
              icon="pi pi-times"
              class="p-button-danger p-button-rounded"
              (click)="deleteStock(stock.stock_symbol)"
              *ngIf="isOwner"
            ></button>
            <button
              pButton
              type="button"
              icon="pi pi-arrow-right"
              class="p-button-rounded"
              (click)="goToStock(stock.stock_symbol)"
            ></button>
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>

  <!-- Add Stock List Correlation Matrix -->
  <div class="mt-10 pt-3 flex">
    <h3 class="text-xl font-bold mb-4 items-center">Stocks Correlation Matrix</h3>
    <app-stock-matrix [data]="correlations" matrixType="correlation"></app-stock-matrix>
  </div>

  <!-- Add Stock List Covariance Matrix -->
  <div class="mt-10 pt-3 flex">
    <h3 class="text-xl font-bold mb-4 items-center">Stocks Covariance Matrix</h3>
    <app-stock-matrix [data]="covariances" matrixType="covariance"></app-stock-matrix>
  </div>

  <!-- Other dialogs and reviews section remain unchanged... -->

  <p-dialog header="Add Date Filter" [contentStyle]="{'overflow': 'visible'}"
  [(visible)]="displayDateFilterDialog" [modal]="true" [closable]="true" [dismissableMask]="true" [responsive]="true" styleClass="w-[30rem]" [baseZIndex]="10000">
    <div class="p-fluid">
      <div class="p-field mb-4">
        <label for="dateRange" class="block text-sm font-medium text-gray-700">Date Range</label>
        <p-calendar id="dateRange" [(ngModel)]="dateRange" selectionMode="range" dateFormat="yy-mm-dd" [showIcon]="true" appendTo="body" class="mt-1 block w-full"></p-calendar>
      </div>
      <div class="text-right">
        <p-button label="Apply" class="p-button-info" (click)="applyDateFilter()" [disabled]="!dateRange || dateRange.length !== 2"></p-button>
      </div>
    </div>
  </p-dialog>
</div>
